create procedure edw.ICICI_CUST_CHANNEL_MASHUP()
begin
  declare Qry varchar(5000);
  truncate table P2C.ICICI_CUST_CHANNEL_MASHUP;
  set Qry
     = 'insert into P2C.ICICI_CUST_CHANNEL_MASHUP\x0A      \x0Aselect null as UCIC,\x0A        ACCOUNT_NUMBER,\x0A        CUSTID,\x0A        30 as SOURCE_SYSTEM_CODE,\x0A        \x0Acase when BILLPAY_REGISTRATION is not null then ''Y'' else ''N''\x0Aend as BILLPAYREGISTERED,\x0A        \x0Acase when Bill_pay_txn_date IS NOT NULL then ''Y'' \x0Aelse ''N'' end as BILLPAYACTIVATED,\x0A        \x0Acase when SIP_DATE is not null then ''Y'' else ''N'' end as SIP,\x0A        \x0Acase when AUTO_DEBIT_AL_DATE is not null then ''Y''\x0A        when AUTO_DEBIT_PL_DATE is not null then ''Y''\x0A        when AUTO_DEBIT_HL_DATE is not null then ''Y''\x0A        when AUTO_DEBIT_CC_DATE is not null then ''Y''\x0A        else ''N''\x0A        end as AUTODEBITMANDATE,\x0Acase when IDIRECT_DATE is not null then ''Y'' else ''N'' end as IDIRECTACCOUNT,\x0A        \x0Acase when RECEIVE_FUND_ACT_DATE is not null then ''Y'' else ''N''\x0Aend as RECEIVEFUNDS,\x0A        \x0Acase when B.IB_LOGIN_ACTIVE=''A'' then ''Y'' else ''N'' end as INTERNETACTIVE,\x0A         \x0Acase when B.MOB_ACTIVATION=''A'' then ''Y'' \x0Aelse ''N'' end as IMOBILEACTIVE,\x0A        \x0Acase when Br_Average_Transfers_trxns is not null or Br_Average_Transfers_trxns <> 0 or Br_Average_Cash_Cr_trxns is not null or Br_Average_Cash_Cr_trxns <> 0\x0A        or Br_Average_Cash_Dr_trxns is not null or Br_Average_Cash_Dr_trxns <> 0 or Br_Average_DD_PO_Dr_trxns is not null or Br_Average_DD_PO_Dr_trxns <> 0\x0A        or Br_Average_Cheque_Cr_trxns is not null or Br_Average_Cheque_Cr_trxns <> 0 or Br_Average_NF_trxns is not null or Br_Average_NF_trxns <> 0\x0A        or Br_Average_Ticket_size is not null or Br_Average_Ticket_size <> 0 then ''Y'' else ''N'' end as BRANCH_ACTIVE,\x0A        \x0Acase when B.ATM_Average_Cash_trxns > 0 or B.ATM_Average_VAS_trxns > 0 or B.ATM_Average_NF_trxns > 0 then ''Y'' else ''N'' \x0Aend as ATMACTIVE\x0A        \x0A ,number(*) from pankajb.Attachment_Datamart_Weekly as A\x0A          \x0Aleft outer join DINESHS.CHANNELDATA_'+DATEformat(DATEADD(mm,-2,GETDATE()),'MMMYY')
    +' as B on A.ACCOUNT_NUMBER = B.SOURCE_ACCOUNT_NBR\x0A    \x0Aupdate P2C.ICICI_CUST_CHANNEL_MASHUP as A\x0A      set A.UCIC = B.UCIC_VALUE from\x0A      P2C.UCIC_LINKAGE_TABLE_UPDATED_FINAL as B\x0A      where trim(A.SOURCE_ACCOUNT_NBR) = trim(B.SOURCE_ACCOUNT_NBR)';
  execute immediate(Qry)
end
