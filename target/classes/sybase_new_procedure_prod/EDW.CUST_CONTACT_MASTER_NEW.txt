create procedure EDW.CUST_CONTACT_MASTER_NEW()
begin
  select cast(null as varchar(30)) as ucic_code,
    TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,
    SOURCE_SYSTEM_CODE,
    cast(null as varchar(30)) as PerPhone2,
    cast(null as varchar(30)) as PerPhone1,
    cast(null as varchar(30)) as PER_MOBILENUMBER,
    PER_EADDRESS,
    cast(null as varchar(30)) as MobileNumber,
    cast(null as varchar(30)) as MailPhone2,
    cast(null as varchar(30)) as MailPhone1,
    cast(null as varchar(30)) as MAIL_MOBILENUMBER,
    MAIL_EADDRESS,
    Eaddress,
    cast(null as varchar(30)) as CurPhone2,
    cast(null as varchar(30)) as CurPhone1,
    cast(null as varchar(30)) as CUR_MOBILENUMBER,
    CUR_EADDRESS,
    cast(null as varchar(30)) as BusPhone2,
    cast(null as varchar(30)) as BusPhone1,
    cast(null as varchar(30)) as BUS_MOBILENUMBER,
    BUS_EADDRESS,
    cast(null as varchar(50)) as R_EMAIL,
    cast(null as varchar(15)) as R_MOBILE,
    cast(null as varchar(50)) as CLEAN_EMAIL,
    cast('N' as varchar(5)) as DNC,
    cast('N' as varchar(5)) as NDNC,
    cast('N' as varchar(5)) as Phone_Escalation,
    cast('N' as varchar(5)) as EMAIL_DNC,
    cast('N' as varchar(5)) as Email_Escalation,
    DATE(GETDATE()) as AS_OF_DATE,
    cast('N' as varchar(5)) as IRIT_SMS,
    cast('N' as varchar(5)) as IRIT_EMAIL,
    cast(null as varchar(5)) as master_exclude,
    cast(null as varchar(5)) as master_exclude_house_wife,
    cast(null as varchar(5)) as staff_flag,
    cast(null as varchar(8)) as income_segment,
    cast(null as varchar(12)) as mobile_pull_reg_mobile_number,
    cast(null as datetime) as mobile_pull_reg_modified_date
    into #CUST_CONTACT
    from EDW.T0111_SOURCE_CUSTOMER_DETAILS_EXTERNAL_SYSTEM;
  commit work;
  insert into #CUST_CONTACT
    select cast(null as varchar(30)) as ucic_code,
      TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,
      SOURCE_SYSTEM_CODE,
      cast(null as varchar(30)) as PerPhone2,
      cast(null as varchar(30)) as PerPhone1,
      cast(null as varchar(30)) as PER_MOBILENUMBER,
      PER_EADDRESS,
      cast(null as varchar(30)) as MobileNumber,
      cast(null as varchar(30)) as MailPhone2,
      cast(null as varchar(30)) as MailPhone1,
      cast(null as varchar(30)) as MAIL_MOBILENUMBER,
      MAIL_EADDRESS,
      Eaddress,
      cast(null as varchar(30)) as CurPhone2,
      cast(null as varchar(30)) as CurPhone1,
      cast(null as varchar(30)) as CUR_MOBILENUMBER,
      CUR_EADDRESS,
      cast(null as varchar(30)) as BusPhone2,
      cast(null as varchar(30)) as BusPhone1,
      cast(null as varchar(30)) as BUS_MOBILENUMBER,
      BUS_EADDRESS,
      cast(null as varchar(50)) as R_EMAIL,
      cast(null as varchar(15)) as R_MOBILE,
      cast(null as varchar(50)) as CLEAN_EMAIL,
      cast('N' as varchar(5)) as DNC,
      cast('N' as varchar(5)) as NDNC,
      cast('N' as varchar(5)) as Phone_Escalation,
      cast('N' as varchar(5)) as EMAIL_DNC,
      cast('N' as varchar(5)) as Email_Escalation,
      DATE(GETDATE()) as AS_OF_DATE,
      cast('N' as varchar(5)) as IRIT_SMS,
      cast('N' as varchar(5)) as IRIT_EMAIL,
      cast(null as varchar(5)) as master_exclude,
      cast(null as varchar(5)) as master_exclude_house_wife,
      cast(null as varchar(5)) as staff_flag,
      cast(null as varchar(8)) as income_segment,
      cast(null as varchar(12)) as mobile_pull_reg_mobile_number,
      cast(null as datetime) as mobile_pull_reg_modified_date
      from EDW.T0111_SOURCE_CUSTOMER_DETAILS where SOURCE_SYSTEM_CODE not in( 40,54,140,150,160 ) ;
  commit work;
  insert into #CUST_CONTACT
    select cast(null as varchar(30)) as ucic_code,
      TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,
      SOURCE_SYSTEM_CODE,
      cast(null as varchar(30)) as PerPhone2,
      cast(null as varchar(30)) as PerPhone1,
      cast(null as varchar(30)) as PER_MOBILENUMBER,
      null as PER_EADDRESS,
      cast(null as varchar(30)) as MobileNumber,
      cast(null as varchar(30)) as MailPhone2,
      cast(null as varchar(30)) as MailPhone1,
      cast(null as varchar(30)) as MAIL_MOBILENUMBER,
      null as MAIL_EADDRESS,
      Eaddress,
      cast(null as varchar(30)) as CurPhone2,
      cast(null as varchar(30)) as CurPhone1,
      cast(null as varchar(30)) as CUR_MOBILENUMBER,
      null as CUR_EADDRESS,
      cast(null as varchar(30)) as BusPhone2,
      cast(null as varchar(30)) as BusPhone1,
      cast(null as varchar(30)) as BUS_MOBILENUMBER,
      null as BUS_EADDRESS,
      cast(null as varchar(50)) as R_EMAIL,
      cast(null as varchar(15)) as R_MOBILE,
      cast(null as varchar(50)) as CLEAN_EMAIL,
      cast('N' as varchar(5)) as DNC,
      cast('N' as varchar(5)) as NDNC,
      cast('N' as varchar(5)) as Phone_Escalation,
      cast('N' as varchar(5)) as EMAIL_DNC,
      cast('N' as varchar(5)) as Email_Escalation,
      DATE(GETDATE()) as AS_OF_DATE,
      cast('N' as varchar(5)) as IRIT_SMS,
      cast('N' as varchar(5)) as IRIT_EMAIL,
      cast(null as varchar(5)) as master_exclude,
      cast(null as varchar(5)) as master_exclude_house_wife,
      cast(null as varchar(5)) as staff_flag,
      cast(null as varchar(8)) as income_segment,
      cast(null as varchar(12)) as mobile_pull_reg_mobile_number,
      cast(null as datetime) as mobile_pull_reg_modified_date
      from EDW.T0111_SOURCE_CUSTOMER_DETAILS_FINONE;
  commit work;
  insert into #CUST_CONTACT
    select cast(null as varchar(30)) as ucic_code,
      TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,
      SOURCE_SYSTEM_CODE,
      cast(null as varchar(30)) as PerPhone2,
      cast(null as varchar(30)) as PerPhone1,
      cast(null as varchar(30)) as PER_MOBILENUMBER,
      null as PER_EADDRESS,
      cast(null as varchar(30)) as MobileNumber,
      cast(null as varchar(30)) as MailPhone2,
      cast(null as varchar(30)) as MailPhone1,
      cast(null as varchar(30)) as MAIL_MOBILENUMBER,
      null as MAIL_EADDRESS,
      Eaddress,
      cast(null as varchar(30)) as CurPhone2,
      cast(null as varchar(30)) as CurPhone1,
      cast(null as varchar(30)) as CUR_MOBILENUMBER,
      null as CUR_EADDRESS,
      cast(null as varchar(30)) as BusPhone2,
      cast(null as varchar(30)) as BusPhone1,
      cast(null as varchar(30)) as BUS_MOBILENUMBER,
      null as BUS_EADDRESS,
      cast(null as varchar(50)) as R_EMAIL,
      cast(null as varchar(15)) as R_MOBILE,
      cast(null as varchar(50)) as CLEAN_EMAIL,
      cast('N' as varchar(5)) as DNC,
      cast('N' as varchar(5)) as NDNC,
      cast('N' as varchar(5)) as Phone_Escalation,
      cast('N' as varchar(5)) as EMAIL_DNC,
      cast('N' as varchar(5)) as Email_Escalation,
      DATE(GETDATE()) as AS_OF_DATE,
      cast('N' as varchar(5)) as IRIT_SMS,
      cast('N' as varchar(5)) as IRIT_EMAIL,
      cast(null as varchar(5)) as master_exclude,
      cast(null as varchar(5)) as master_exclude_house_wife,
      cast(null as varchar(5)) as staff_flag,
      cast(null as varchar(8)) as income_segment,
      cast(null as varchar(12)) as mobile_pull_reg_mobile_number,
      cast(null as datetime) as mobile_pull_reg_modified_date
      from FINAGRI.T0111_SOURCE_CUSTOMER_DETAILS;
  commit work;
  insert into #CUST_CONTACT
    select cast(null as varchar(30)) as ucic_code,
      TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,
      SOURCE_SYSTEM_CODE,
      cast(null as varchar(30)) as PerPhone2,
      cast(null as varchar(30)) as PerPhone1,
      cast(null as varchar(30)) as PER_MOBILENUMBER,
      cast(PER_EADDRESS as varchar),
      cast(null as varchar(30)) as MobileNumber,
      cast(null as varchar(30)) as MailPhone2,
      cast(null as varchar(30)) as MailPhone1,
      cast(null as varchar(30)) as MAIL_MOBILENUMBER,
      cast(MAIL_EADDRESS as varchar),
      Eaddress,
      cast(null as varchar(30)) as CurPhone2,
      cast(null as varchar(30)) as CurPhone1,
      cast(null as varchar(30)) as CUR_MOBILENUMBER,
      CUR_EADDRESS,
      cast(null as varchar(30)) as BusPhone2,
      cast(null as varchar(30)) as BusPhone1,
      cast(null as varchar(30)) as BUS_MOBILENUMBER,
      BUS_EADDRESS,
      cast(null as varchar(50)) as R_EMAIL,
      cast(null as varchar(15)) as R_MOBILE,
      cast(null as varchar(50)) as CLEAN_EMAIL,
      cast('N' as varchar(5)) as DNC,
      cast('N' as varchar(5)) as NDNC,
      cast('N' as varchar(5)) as Phone_Escalation,
      cast('N' as varchar(5)) as EMAIL_DNC,
      cast('N' as varchar(5)) as Email_Escalation,
      DATE(GETDATE()) as AS_OF_DATE,
      cast('N' as varchar(5)) as IRIT_SMS,
      cast('N' as varchar(5)) as IRIT_EMAIL,
      cast(null as varchar(5)) as master_exclude,
      cast(null as varchar(5)) as master_exclude_house_wife,
      cast(null as varchar(5)) as staff_flag,
      cast(null as varchar(8)) as income_segment,
      cast(null as varchar(12)) as mobile_pull_reg_mobile_number,
      cast(null as datetime) as mobile_pull_reg_modified_date
      from EDW.T0111_SOURCE_CUSTOMER_DETAILS_EPMS;
  commit work;
  insert into #CUST_CONTACT
    select cast(null as varchar(30)) as ucic_code,
      TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,
      SOURCE_SYSTEM_CODE,
      cast(null as varchar(30)) as PerPhone2,
      cast(null as varchar(30)) as PerPhone1,
      null as PER_MOBILENUMBER,
      null as PER_EADDRESS,
      cast(null as varchar(30)) as MobileNumber,
      cast(null as varchar(30)) as MailPhone2,
      cast(null as varchar(30)) as MailPhone1,
      cast(null as varchar(30)) as MAIL_MOBILENUMBER,
      null as MAIL_EADDRESS,
      Eaddress,
      cast(null as varchar(30)) as CurPhone2,
      cast(null as varchar(30)) as CurPhone1,
      cast(null as varchar(30)) as CUR_MOBILENUMBER,
      null as CUR_EADDRESS,
      cast(null as varchar(30)) as BusPhone2,
      cast(null as varchar(30)) as BusPhone1,
      cast(null as varchar(30)) as BUS_MOBILENUMBER,
      null as BUS_EADDRESS,
      cast(null as varchar(50)) as R_EMAIL,
      cast(null as varchar(15)) as R_MOBILE,
      cast(null as varchar(50)) as CLEAN_EMAIL,
      cast('N' as varchar(5)) as DNC,
      cast('N' as varchar(5)) as NDNC,
      cast('N' as varchar(5)) as Phone_Escalation,
      cast('N' as varchar(5)) as EMAIL_DNC,
      cast('N' as varchar(5)) as Email_Escalation,
      DATE(GETDATE()) as AS_OF_DATE,
      cast('N' as varchar(5)) as IRIT_SMS,
      cast('N' as varchar(5)) as IRIT_EMAIL,
      cast(null as varchar(5)) as master_exclude,
      cast(null as varchar(5)) as master_exclude_house_wife,
      cast(null as varchar(5)) as staff_flag,
      cast(null as varchar(8)) as income_segment,
      cast(null as varchar(12)) as mobile_pull_reg_mobile_number,
      cast(null as datetime) as mobile_pull_reg_modified_date
      from FINAGRI.T0111_SOURCE_CUSTOMER_DETAILS_B2;
  commit work;
  insert into #CUST_CONTACT
    select cast(null as varchar(30)) as ucic_code,
      TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,
      SOURCE_SYSTEM_CODE,
      cast(null as varchar(30)) as PerPhone2,
      cast(null as varchar(30)) as PerPhone1,
      cast(null as varchar(30)) as PER_MOBILENUMBER,
      null as PER_EADDRESS,
      cast(null as varchar(30)) as MobileNumber,
      cast(null as varchar(30)) as MailPhone2,
      cast(null as varchar(30)) as MailPhone1,
      cast(null as varchar(30)) as MAIL_MOBILENUMBER,
      null as MAIL_EADDRESS,
      Eaddress,
      cast(null as varchar(30)) as CurPhone2,
      cast(null as varchar(30)) as CurPhone1,
      cast(null as varchar(30)) as CUR_MOBILENUMBER,
      null as CUR_EADDRESS,
      cast(null as varchar(30)) as BusPhone2,
      cast(null as varchar(30)) as BusPhone1,
      cast(null as varchar(30)) as BUS_MOBILENUMBER,
      null as BUS_EADDRESS,
      cast(null as varchar(50)) as R_EMAIL,
      cast(null as varchar(15)) as R_MOBILE,
      cast(null as varchar(50)) as CLEAN_EMAIL,
      cast('N' as varchar(5)) as DNC,
      cast('N' as varchar(5)) as NDNC,
      cast('N' as varchar(5)) as Phone_Escalation,
      cast('N' as varchar(5)) as EMAIL_DNC,
      cast('N' as varchar(5)) as Email_Escalation,
      DATE(GETDATE()) as AS_OF_DATE,
      cast('N' as varchar(5)) as IRIT_SMS,
      cast('N' as varchar(5)) as IRIT_EMAIL,
      cast(null as varchar(5)) as master_exclude,
      cast(null as varchar(5)) as master_exclude_house_wife,
      cast(null as varchar(5)) as staff_flag,
      cast(null as varchar(8)) as income_segment,
      cast(null as varchar(12)) as mobile_pull_reg_mobile_number,
      cast(null as datetime) as mobile_pull_reg_modified_date
      from EDW.CO_APPLICANT_CUSTOMER_DETAILS_FINONE;
  commit work;
  insert into #CUST_CONTACT
    select cast(null as varchar(30)) as ucic_code,
      TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,
      SOURCE_SYSTEM_CODE,
      cast(null as varchar(30)) as PerPhone2,
      cast(null as varchar(30)) as PerPhone1,
      cast(null as varchar(30)) as PER_MOBILENUMBER,
      PER_EADDRESS,
      cast(null as varchar(30)) as MobileNumber,
      cast(null as varchar(30)) as MailPhone2,
      cast(null as varchar(30)) as MailPhone1,
      MAIL_MOBILENUMBER,
      MAIL_EADDRESS,
      Eaddress,
      cast(null as varchar(30)) as CurPhone2,
      cast(null as varchar(30)) as CurPhone1,
      cast(null as varchar(30)) as CUR_MOBILENUMBER,
      CUR_EADDRESS,
      cast(null as varchar(30)) as BusPhone2,
      cast(null as varchar(30)) as BusPhone1,
      cast(null as varchar(30)) as BUS_MOBILENUMBER,
      BUS_EADDRESS,
      cast(null as varchar(50)) as R_EMAIL,
      cast(null as varchar(15)) as R_MOBILE,
      cast(null as varchar(50)) as CLEAN_EMAIL,
      cast('N' as varchar(5)) as DNC,
      cast('N' as varchar(5)) as NDNC,
      cast('N' as varchar(5)) as Phone_Escalation,
      cast('N' as varchar(5)) as EMAIL_DNC,
      cast('N' as varchar(5)) as Email_Escalation,
      DATE(GETDATE()) as AS_OF_DATE,
      cast('N' as varchar(5)) as IRIT_SMS,
      cast('N' as varchar(5)) as IRIT_EMAIL,
      cast(null as varchar(5)) as master_exclude,
      cast(null as varchar(5)) as master_exclude_house_wife,
      cast(null as varchar(5)) as staff_flag,
      cast(null as varchar(8)) as income_segment,
      cast(null as varchar(12)) as mobile_pull_reg_mobile_number,
      cast(null as datetime) as mobile_pull_reg_modified_date
      from EDW.T0111_SOURCE_CUSTOMER_DETAILS_M2I;
  commit work;
  insert into #CUST_CONTACT
    select cast(null as varchar(30)) as ucic_code,
      TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,
      SOURCE_SYSTEM_CODE,
      cast(null as varchar(30)) as PerPhone2,
      cast(null as varchar(30)) as PerPhone1,
      cast(null as varchar(30)) as PER_MOBILENUMBER,
      PER_EADDRESS,
      cast(null as varchar(30)) as MobileNumber,
      cast(null as varchar(30)) as MailPhone2,
      cast(null as varchar(30)) as MailPhone1,
      cast(null as varchar(30)) as MAIL_MOBILENUMBER,
      MAIL_EADDRESS,
      Eaddress,
      cast(null as varchar(30)) as CurPhone2,
      cast(null as varchar(30)) as CurPhone1,
      cast(null as varchar(30)) as CUR_MOBILENUMBER,
      CUR_EADDRESS,
      cast(null as varchar(30)) as BusPhone2,
      cast(null as varchar(30)) as BusPhone1,
      cast(null as varchar(30)) as BUS_MOBILENUMBER,
      BUS_EADDRESS,
      cast(null as varchar(50)) as R_EMAIL,
      cast(null as varchar(15)) as R_MOBILE,
      cast(null as varchar(50)) as CLEAN_EMAIL,
      cast('N' as varchar(5)) as DNC,
      cast('N' as varchar(5)) as NDNC,
      cast('N' as varchar(5)) as Phone_Escalation,
      cast('N' as varchar(5)) as EMAIL_DNC,
      cast('N' as varchar(5)) as Email_Escalation,
      DATE(GETDATE()) as AS_OF_DATE,
      cast('N' as varchar(5)) as IRIT_SMS,
      cast('N' as varchar(5)) as IRIT_EMAIL,
      cast(null as varchar(5)) as master_exclude,
      cast(null as varchar(5)) as master_exclude_house_wife,
      cast(null as varchar(5)) as staff_flag,
      cast(null as varchar(8)) as income_segment,
      cast(null as varchar(12)) as mobile_pull_reg_mobile_number,
      cast(null as datetime) as mobile_pull_reg_modified_date
      from EDW.T0111_SOURCE_CUSTOMER_DETAILS_NRISR;
  commit work;
  delete from #CUST_CONTACT where trim(SOURCE_PARTY_ID) = any(select SOURCE_PARTY_ID from P2C.UCIC_LINKAGE_TABLE_UPDATED_FINAL where ACCOUNT_CLOSE_DATE is not null);
  commit work;
  update #CUST_CONTACT as A
    set A.UCIC_CODE = B.UCIC_VALUE from
    (select UCIC_VALUE,TRIM(SOURCE_PARTY_ID) as SOURCE_PARTY_ID,SOURCE_SYSTEM_CODE from P2C.UCIC_LINKAGE_TABLE_UPDATED_FINAL) as B
    where A.SOURCE_PARTY_ID = B.SOURCE_PARTY_ID
    and A.SOURCE_SYSTEM_CODE = B.SOURCE_SYSTEM_CODE;
  commit work;
  update #CUST_CONTACT as A
    set A.R_MOBILE = B.MODE_ID from
    (select B.SOURCE_PARTY_ID,A.MODE_ID from EDW.T09527_MOBILE_ALERT_REG as A,P2C.UCIC_LINKAGE_TABLE_UPDATED_FINAL as B where A.SOURCE_ACCOUNT_NBR = B.SOURCE_ACCOUNT_NBR and A.MODE_OF_DELIVERY = '0') as B
    where A.SOURCE_PARTY_ID = B.SOURCE_PARTY_ID;
  commit work;
  update #CUST_CONTACT as A
    set A.PerPhone2 = B.PerPhone2,
    A.PerPhone1 = B.PerPhone1,
    A.PER_MOBILENUMBER = B.PER_MOBILENUMBER,
    A.MobileNumber = B.MobileNumber,
    A.MailPhone2 = B.MailPhone2,
    A.MailPhone1 = B.MailPhone1,
    A.MAIL_MOBILENUMBER = B.MAIL_MOBILENUMBER,
    A.CurPhone2 = B.CurPhone2,
    A.CurPhone1 = B.CurPhone1,
    A.CUR_MOBILENUMBER = B.CUR_MOBILENUMBER,
    A.BusPhone2 = B.BusPhone2,
    A.BusPhone1 = B.BusPhone1,
    A.BUS_MOBILENUMBER = B.BUS_MOBILENUMBER from
    MCCM.CUST_CLEAN_MOBILE_HIST as B
    where TRIM(A.SOURCE_PARTY_ID) = TRIM(B.SOURCE_PARTY_ID)
    and A.SOURCE_SYSTEM_CODE = B.SOURCE_SYSTEM_CODE;
  commit work;
  truncate table MCCM.CUST_CONTACT_MASTER;
  commit work;
  insert into MCCM.CUST_CONTACT_MASTER select * from #CUST_CONTACT;
  commit work
end
