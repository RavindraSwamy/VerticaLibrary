create procedure edw.Cmg_Trade_Finance_Load()
begin
  truncate table srcstage.s_Main_Cmg_FPC;
  commit work;
  load into table srcstage.s_Main_Cmg_FPC( CIF_ID '~^',JCCI_CODE '~^',SSI_FLG '~^',HUND_PCNT_EOU_FLG '~^',CAUTION_STAT '~^',RCRE_TIME '~^',LCHG_TIME '\x0A' ) using file
    '/sybase_load/LOAD_MANAGEMENT/WEEKLYFIN/ACCOUNT/YET_TO_LOAD_FILES/cmg_trade_finance.out' quotes off escapes off preview on ignore constraint all 0 message log '/sybase_load/LOAD_MANAGEMENT/WEEKLYFIN/ACCOUNT/LOAD_LOGS/ERROR_RECORDS_MSSG/cmg_trade_finance.msg' row log '/sybase_load/LOAD_MANAGEMENT/WEEKLYFIN/ACCOUNT/LOAD_LOGS/ERROR_RECORDS_DATA/cmg_trade_finance.row' only log all log delimited by '|' notify 100000 with checkpoint on;
  commit work;
  update srcstage.Main_Cmg_FPC as a
    set JCCI_CODE = b.JCCI_CODE,
    SSI_FLG = b.SSI_FLG,
    HUND_PCNT_EOU_FLG = b.HUND_PCNT_EOU_FLG,
    CAUTION_STAT = b.CAUTION_STAT,
    RCRE_TIME = b.RCRE_TIME,
    LCHG_TIME = b.LCHG_TIME from
    srcstage.s_Main_Cmg_FPC as b
    where a.CIF_ID = b.CIF_ID;
  commit work;
  insert into srcstage.Main_Cmg_FPC
    select * from srcstage.s_Main_Cmg_FPC as a
      where not a.cif_id = any(select cif_id from srcstage.Main_Cmg_FPC);
  commit work;
  update srcstage.Main_Cmg_Trade_Finance as Cmg_Trade
    set ENTITY_CRE_FLG = a.ENTITY_CRE_FLG,
    DEL_FLG = a.DEL_FLG,
    CUST_TITLE_CODE = a.CUST_TITLE_CODE,
    CUST_NAME = a.CUST_NAME,
    CUST_PERM_ADDR1 = a.CUST_PERM_ADDR1,
    CUST_PERM_ADDR2 = a.CUST_PERM_ADDR2,
    CUST_PERM_ADDR3 = a.CUST_PERM_ADDR3,
    CUST_PERM_CITY_CODE = a.CUST_PERM_CITY_CODE,
    CUST_PERM_STATE_CODE = a.CUST_PERM_STATE_CODE,
    CUST_PERM_PIN_CODE = a.CUST_PERM_PIN_CODE,
    CUST_PERM_CNTRY_CODE = a.CUST_PERM_CNTRY_CODE,
    CUST_PERM_PHONE_NUM = a.CUST_PERM_PHONE_NUM,
    CUST_PERM_TELEX_NUM = a.CUST_PERM_TELEX_NUM,
    CUST_SEX = a.CUST_SEX,
    CUST_COMU_ADDR1 = a.CUST_COMU_ADDR1,
    CUST_COMU_ADDR2 = a.CUST_COMU_ADDR2,
    CUST_COMU_ADDR3 = a.CUST_COMU_ADDR3,
    CUST_COMU_CITY_CODE = a.CUST_COMU_CITY_CODE,
    CUST_COMU_STATE_CODE = a.CUST_COMU_STATE_CODE,
    CUST_COMU_PIN_CODE = a.CUST_COMU_PIN_CODE,
    CUST_COMU_CNTRY_CODE = a.CUST_COMU_CNTRY_CODE,
    CUST_COMU_PHONE_NUM_1 = a.CUST_COMU_PHONE_NUM_1,
    CUST_COMU_PHONE_NUM_2 = a.CUST_COMU_PHONE_NUM_2,
    CUST_COMU_TELEX_NUM = a.CUST_COMU_TELEX_NUM,
    CUST_OCCP_CODE = a.CUST_OCCP_CODE,
    CUST_COMMU_CODE = a.CUST_COMMU_CODE,
    CUST_FIRST_ACCT_DATE = a.CUST_FIRST_ACCT_DATE,
    CUST_INTROD_CUST_ID = a.CUST_INTROD_CUST_ID,
    INTROD_TITLE_CODE = a.INTROD_TITLE_CODE,
    CUST_INTROD_NAME = a.CUST_INTROD_NAME,
    CUST_INTROD_STAT_CODE = a.CUST_INTROD_STAT_CODE,
    CUST_TYPE_CODE = a.CUST_TYPE_CODE,
    CUST_STAT_CODE = a.CUST_STAT_CODE,
    CUST_STAT_CHG_DATE = a.CUST_STAT_CHG_DATE,
    CUST_CONST = a.CUST_CONST,
    CUST_MINOR_FLG = a.CUST_MINOR_FLG,
    CUST_NRE_FLG = a.CUST_NRE_FLG,
    LCHG_TIME = a.LCHG_TIME,
    RCRE_TIME = a.RCRE_TIME,
    DATE_OF_BIRTH = a.DATE_OF_BIRTH,
    PAN_GIR_NUM = a.PAN_GIR_NUM,
    PSPRT_NUM = a.PSPRT_NUM,
    PSPRT_ISSU_DATE = a.PSPRT_ISSU_DATE,
    PSPRT_DET = a.PSPRT_DET,
    PSPRT_EXP_DATE = a.PSPRT_EXP_DATE,
    CUST_PAGER_NO = a.CUST_PAGER_NO,
    CUST_FAX_NO = a.CUST_FAX_NO,
    TDS_EXMPT_END_DATE = a.TDS_EXMPT_END_DATE,
    TDS_EXMPT_SUBMIT_DATE = a.TDS_EXMPT_SUBMIT_DATE,
    TDS_EXMPT_REF_NUM = a.TDS_EXMPT_REF_NUM,
    TDS_EXMPT_RMKS = a.TDS_EXMPT_RMKS,
    CRNCY_CODE = a.CRNCY_CODE,
    EMAIL_ID = a.EMAIL_ID,
    PRIMARY_SOL_ID = a.PRIMARY_SOL_ID,
    DSA_ID = a.DSA_ID,
    CUST_OPN_DATE = a.CUST_OPN_DATE,
    CUST_MARITAL_STATUS = a.CUST_MARITAL_STATUS,
    EMPLOYER_ID = a.EMPLOYER_ID,
    JCCI_CODE = b.JCCI_CODE,
    SSI_FLG = b.SSI_FLG,
    HUND_PCNT_EOU_FLG = b.HUND_PCNT_EOU_FLG,
    CAUTION_STAT = b.CAUTION_STAT from
    srcstage.cust_mast_gen_table as a
    ,srcstage.Main_Cmg_FPC as b
    where trim(a.cust_id) = b.cif_id
    and a.cust_id = Cmg_Trade.cust_id
    and a.lchg_time >= (select max(lchg_time) from srcstage.Main_Cmg_Trade_Finance);
  commit work;
  insert into srcstage.Main_Cmg_Trade_Finance
    select a_CUST_ID,
      a_ENTITY_CRE_FLG,
      a_DEL_FLG,
      a_CUST_TITLE_CODE,
      a_CUST_NAME,
      a_CUST_PERM_ADDR1,
      a_CUST_PERM_ADDR2,
      a_CUST_PERM_ADDR3,
      a_CUST_PERM_CITY_CODE,
      a_CUST_PERM_STATE_CODE,
      a_CUST_PERM_PIN_CODE,
      a_CUST_PERM_CNTRY_CODE,
      a_CUST_PERM_PHONE_NUM,
      a_CUST_PERM_TELEX_NUM,
      a_CUST_SEX,
      a_CUST_COMU_ADDR1,
      a_CUST_COMU_ADDR2,
      a_CUST_COMU_ADDR3,
      a_CUST_COMU_CITY_CODE,
      a_CUST_COMU_STATE_CODE,
      a_CUST_COMU_PIN_CODE,
      a_CUST_COMU_CNTRY_CODE,
      a_CUST_COMU_PHONE_NUM_1,
      a_CUST_COMU_PHONE_NUM_2,
      a_CUST_COMU_TELEX_NUM,
      a_CUST_OCCP_CODE,
      a_CUST_COMMU_CODE,
      a_CUST_FIRST_ACCT_DATE,
      a_CUST_INTROD_CUST_ID,
      a_INTROD_TITLE_CODE,
      a_CUST_INTROD_NAME,
      a_CUST_INTROD_STAT_CODE,
      a_CUST_TYPE_CODE,
      a_CUST_STAT_CODE,
      a_CUST_STAT_CHG_DATE,
      a_CUST_CONST,
      a_CUST_MINOR_FLG,
      a_CUST_NRE_FLG,
      a_LCHG_TIME,
      a_RCRE_TIME,
      a_DATE_OF_BIRTH,
      a_PAN_GIR_NUM,
      a_PSPRT_NUM,
      a_PSPRT_ISSU_DATE,
      a_PSPRT_DET,
      a_PSPRT_EXP_DATE,
      a_CUST_PAGER_NO,
      a_CUST_FAX_NO,
      a_TDS_EXMPT_END_DATE,
      a_TDS_EXMPT_SUBMIT_DATE,
      a_TDS_EXMPT_REF_NUM,
      a_TDS_EXMPT_RMKS,
      a_CRNCY_CODE,
      a_EMAIL_ID,
      a_PRIMARY_SOL_ID,
      a_DSA_ID,
      a_CUST_OPN_DATE,
      a_CUST_MARITAL_STATUS,
      a_EMPLOYER_ID,
      x.JCCI_CODE,
      x.SSI_FLG,
      x.HUND_PCNT_EOU_FLG,
      x.CAUTION_STAT
      from(select Cmg_Trade.cust_id as Cmg_Trade_cust_id,
          a.CUST_ID as a_CUST_ID,
          a.ENTITY_CRE_FLG as a_ENTITY_CRE_FLG,
          a.DEL_FLG as a_DEL_FLG,
          a.CUST_TITLE_CODE as a_CUST_TITLE_CODE,
          a.CUST_NAME as a_CUST_NAME,
          a.CUST_PERM_ADDR1 as a_CUST_PERM_ADDR1,
          a.CUST_PERM_ADDR2 as a_CUST_PERM_ADDR2,
          a.CUST_PERM_ADDR3 as a_CUST_PERM_ADDR3,
          a.CUST_PERM_CITY_CODE as a_CUST_PERM_CITY_CODE,
          a.CUST_PERM_STATE_CODE as a_CUST_PERM_STATE_CODE,
          a.CUST_PERM_PIN_CODE as a_CUST_PERM_PIN_CODE,
          a.CUST_PERM_CNTRY_CODE as a_CUST_PERM_CNTRY_CODE,
          a.CUST_PERM_PHONE_NUM as a_CUST_PERM_PHONE_NUM,
          a.CUST_PERM_TELEX_NUM as a_CUST_PERM_TELEX_NUM,
          a.CUST_SEX as a_CUST_SEX,
          a.CUST_COMU_ADDR1 as a_CUST_COMU_ADDR1,
          a.CUST_COMU_ADDR2 as a_CUST_COMU_ADDR2,
          a.CUST_COMU_ADDR3 as a_CUST_COMU_ADDR3,
          a.CUST_COMU_CITY_CODE as a_CUST_COMU_CITY_CODE,
          a.CUST_COMU_STATE_CODE as a_CUST_COMU_STATE_CODE,
          a.CUST_COMU_PIN_CODE as a_CUST_COMU_PIN_CODE,
          a.CUST_COMU_CNTRY_CODE as a_CUST_COMU_CNTRY_CODE,
          a.CUST_COMU_PHONE_NUM_1 as a_CUST_COMU_PHONE_NUM_1,
          a.CUST_COMU_PHONE_NUM_2 as a_CUST_COMU_PHONE_NUM_2,
          a.CUST_COMU_TELEX_NUM as a_CUST_COMU_TELEX_NUM,
          a.CUST_OCCP_CODE as a_CUST_OCCP_CODE,
          a.CUST_COMMU_CODE as a_CUST_COMMU_CODE,
          a.CUST_FIRST_ACCT_DATE as a_CUST_FIRST_ACCT_DATE,
          a.CUST_INTROD_CUST_ID as a_CUST_INTROD_CUST_ID,
          a.INTROD_TITLE_CODE as a_INTROD_TITLE_CODE,
          a.CUST_INTROD_NAME as a_CUST_INTROD_NAME,
          a.CUST_INTROD_STAT_CODE as a_CUST_INTROD_STAT_CODE,
          a.CUST_TYPE_CODE as a_CUST_TYPE_CODE,
          a.CUST_STAT_CODE as a_CUST_STAT_CODE,
          a.CUST_STAT_CHG_DATE as a_CUST_STAT_CHG_DATE,
          a.CUST_CONST as a_CUST_CONST,
          a.CUST_MINOR_FLG as a_CUST_MINOR_FLG,
          a.CUST_NRE_FLG as a_CUST_NRE_FLG,
          a.LCHG_TIME as a_LCHG_TIME,
          a.RCRE_TIME as a_RCRE_TIME,
          a.DATE_OF_BIRTH as a_DATE_OF_BIRTH,
          a.PAN_GIR_NUM as a_PAN_GIR_NUM,
          a.PSPRT_NUM as a_PSPRT_NUM,
          a.PSPRT_ISSU_DATE as a_PSPRT_ISSU_DATE,
          a.PSPRT_DET as a_PSPRT_DET,
          a.PSPRT_EXP_DATE as a_PSPRT_EXP_DATE,
          a.CUST_PAGER_NO as a_CUST_PAGER_NO,
          a.CUST_FAX_NO as a_CUST_FAX_NO,
          a.TDS_EXMPT_END_DATE as a_TDS_EXMPT_END_DATE,
          a.TDS_EXMPT_SUBMIT_DATE as a_TDS_EXMPT_SUBMIT_DATE,
          a.TDS_EXMPT_REF_NUM as a_TDS_EXMPT_REF_NUM,
          a.TDS_EXMPT_RMKS as a_TDS_EXMPT_RMKS,
          a.CRNCY_CODE as a_CRNCY_CODE,
          a.EMAIL_ID as a_EMAIL_ID,
          a.PRIMARY_SOL_ID as a_PRIMARY_SOL_ID,
          a.DSA_ID as a_DSA_ID,
          a.CUST_OPN_DATE as a_CUST_OPN_DATE,
          a.CUST_MARITAL_STATUS as a_CUST_MARITAL_STATUS,
          a.EMPLOYER_ID as a_EMPLOYER_ID,
          b.JCCI_CODE,
          b.SSI_FLG,
          b.HUND_PCNT_EOU_FLG,
          b.CAUTION_STAT
          from srcstage.cust_mast_gen_table as a
            left outer join srcstage.Main_Cmg_FPC as b
            on trim(a.cust_id) = cif_id
            left outer join srcstage.Main_Cmg_Trade_Finance as Cmg_Trade
            on a.cust_id = cmg_trade.cust_id
          where a.lchg_time >= (select max(lchg_time) from srcstage.Main_Cmg_Trade_Finance)) as x
      where Cmg_Trade_cust_id is null;
  commit work
end
