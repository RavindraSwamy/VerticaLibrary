create procedure edw.ADT_CMG_Intrdy()
begin
  load into table edw.ADT_CMG_PRE_PROCESS_Intrdy( AUDIT_TEXT '|~',AUDITID '|~',BANK_ID '|~',AUDITEDBONAME '|~',AUDITEDID '|~',CUST_ID '|~',TABLENAME '|~',BODATECREATED '|~',BOCREATEDBY '|~',Enterer_Id '|~',BODATEMODIFIED '|~',BOMODIFIEDBY '|~',BOACLID '|~',EXTENSIONID '|~',TMDATE '\x0A' ) using file
    '/sybase_load/LOAD_MANAGEMENT/WEEKLYFIN/ACCOUNT/YET_TO_LOAD_FILES/adt_cmg_intrdy_final.out' quotes off escapes off preview on ignore constraint all 0 message log '/sybase_load/LOAD_MANAGEMENT/WEEKLYFIN/ACCOUNT/LOAD_LOGS/ERROR_RECORDS_MSSG/adt_cmg_intrdy_final.out.msg' row log '/sybase_load/LOAD_MANAGEMENT/WEEKLYFIN/ACCOUNT/LOAD_LOGS/ERROR_RECORDS_DATA/adt_cmg_intrdy_final.out.row' only log all log delimited by '|~' notify 100000 with checkpoint on;
  commit work;
  select * into #ADT_CMG_PRE_PROCESS_Intrdy from edw.ADT_CMG_PRE_PROCESS_Intrdy
    where(bodatecreated > (select max(Record_Creation_Date) from EDW.TEMP_BIU_NON_FIN_DETAILS_N_SUR_Intrdy)
    or bodatemodified > (select max(Record_Modification_Date) from EDW.TEMP_BIU_NON_FIN_DETAILS_N_SUR_Intrdy));
  commit work;
  select distinct cast(null as numeric(30)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PAGER_NO' as varchar(100)) as Attribute_1,
    cast(substr(a.Audit_Text,locate(a.Audit_Text,'ov=')+length('ov='),((locate(a.Audit_Text,'inner =')-1)
    -(locate(a.Audit_Text,'ov=')+length('ov=')))) as varchar(100)) as Attribute_2,
    cast(null as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar(50)) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
        -(locate(Audit_Text,'ov=')+length('ov=')))) = 'CELLPH'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt not like 'New%') as b_old
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_old.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_old.adt_txt;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PAGER_NO' as varchar(100)) as Attribute_1,
    cast(null as varchar(100)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),locate(Audit_Text,'inner =')-locate(Audit_Text,'v=')-3) = 'CELLPH'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_new.adt_txt;
  commit work;
  update #temp_1 as a
    set Attribute_3 = b.Attribute_3 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  --insert into #temp_cmg_attrib--
  select b_Row_Id,
    b_Customer_Id,
    b_Account_Id,
    b_Unique_Id,
    b_Category,
    b_Sub_Category,
    b_Source,
    b_Audit_Date,
    b_Attribute_1,
    b_Attribute_2,
    b_Attribute_3,
    b_Record_Creation_Date,
    b_Record_Modification_Date,
    b_Record_Valid_Flag,
    b_Gl_Sub_Head_Code,
    b_Rmks,
    b_Func_Code,
    b_Init_Sol_Id,
    b_Enterer_Id,
    b_Auth_Id,
    b_Table_Name,
    b_Auth_Sol_Id
    into #temp_cmg_attrib
    from(select a.customer_id as a_customer_id,
        a.Enterer_Id as a_Enterer_Id,
        a.Attribute_1 as a_Attribute_1,
        b.Row_Id as b_Row_Id,
        b.Customer_Id as b_Customer_Id,
        b.Account_Id as b_Account_Id,
        b.Unique_Id as b_Unique_Id,
        b.Category as b_Category,
        b.Sub_Category as b_Sub_Category,
        b.Source as b_Source,
        b.Audit_Date as b_Audit_Date,
        b.Attribute_1 as b_Attribute_1,
        b.Attribute_2 as b_Attribute_2,
        b.Attribute_3 as b_Attribute_3,
        b.Record_Creation_Date as b_Record_Creation_Date,
        b.Record_Modification_Date as b_Record_Modification_Date,
        b.Record_Valid_Flag as b_Record_Valid_Flag,
        b.Gl_Sub_Head_Code as b_Gl_Sub_Head_Code,
        b.Rmks as b_Rmks,
        b.Func_Code as b_Func_Code,
        b.Init_Sol_Id as b_Init_Sol_Id,
        b.Enterer_Id as b_Enterer_Id,
        b.Auth_Id as b_Auth_Id,
        b.Table_Name as b_Table_Name,
        b.Auth_Sol_Id as b_Auth_Sol_Id
        from #temp_1 as a right outer join #temp_2 as b
          on a.customer_id = b.customer_id
          and a.enterer_id = b.enterer_id
          and a.Attribute_1 = b.Attribute_1
        where(a_customer_id is null or a_Enterer_Id is null or a_Attribute_1 is null)) as x;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      from #temp_1;
  commit work;
  --select * from #temp_1
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id, -- 
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Email' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('EMAIL_ID' as varchar(100)) as Attribute_1,
    cast(substr(a.Audit_Text,locate(a.Audit_Text,'ov=')+length('ov='),((locate(a.Audit_Text,'inner =')-1)
    -(locate(a.Audit_Text,'ov=')+length('ov=')))) as varchar(100)) as Attribute_2,
    cast(null as varchar(50)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
        -(locate(Audit_Text,'ov=')+length('ov=')))) = 'COMMEML'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt not like 'New%') as b_old
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'$Email ') >= 1
    and a.cust_id = b_old.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_old.adt_txt;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Email' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('EMAIL_ID' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(50)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),locate(Audit_Text,'inner =')-locate(Audit_Text,'v=')-3) = 'COMMEML'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'$Email ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_new.adt_txt;
  commit work;
  update #temp_1 as a
    set Attribute_3 = b.Attribute_3 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select b_Row_Id,
      b_Customer_Id,
      b_Account_Id,
      b_Unique_Id,
      b_Category,
      b_Sub_Category,
      b_Source,
      b_Audit_Date,
      b_Attribute_1,
      b_Attribute_2,
      b_Attribute_3,
      b_Record_Creation_Date,
      b_Record_Modification_Date,
      b_Record_Valid_Flag,
      b_Gl_Sub_Head_Code,
      b_Rmks,
      b_Func_Code,
      b_Init_Sol_Id,
      b_Enterer_Id,
      b_Auth_Id,
      b_Table_Name,
      b_Auth_Sol_Id
      from(select a.customer_id as a_customer_id,
          a.Enterer_Id as a_Enterer_Id,
          a.Attribute_1 as a_Attribute_1,
          b.Row_Id as b_Row_Id,
          b.Customer_Id as b_Customer_Id,
          b.Account_Id as b_Account_Id,
          b.Unique_Id as b_Unique_Id,
          b.Category as b_Category,
          b.Sub_Category as b_Sub_Category,
          b.Source as b_Source,
          b.Audit_Date as b_Audit_Date,
          b.Attribute_1 as b_Attribute_1,
          b.Attribute_2 as b_Attribute_2,
          b.Attribute_3 as b_Attribute_3,
          b.Record_Creation_Date as b_Record_Creation_Date,
          b.Record_Modification_Date as b_Record_Modification_Date,
          b.Record_Valid_Flag as b_Record_Valid_Flag,
          b.Gl_Sub_Head_Code as b_Gl_Sub_Head_Code,
          b.Rmks as b_Rmks,
          b.Func_Code as b_Func_Code,
          b.Init_Sol_Id as b_Init_Sol_Id,
          b.Enterer_Id as b_Enterer_Id,
          b.Auth_Id as b_Auth_Id,
          b.Table_Name as b_Table_Name,
          b.Auth_Sol_Id as b_Auth_Sol_Id
          from #temp_1 as a right outer join #temp_2 as b
            on a.customer_id = b.customer_id
            and a.enterer_id = b.enterer_id
            and a.Attribute_1 = b.Attribute_1
          where(a_customer_id is null or a_Enterer_Id is null or a_Attribute_1 is null)) as x;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      from #temp_1;
  commit work; -- 
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_PHONE_NUM_1' as varchar(100)) as Attribute_1,
    cast(substr(a.Audit_Text,locate(a.Audit_Text,'ov=')+length('ov='),((locate(a.Audit_Text,'inner =')-1)
    -(locate(a.Audit_Text,'ov=')+length('ov=')))) as varchar(100)) as Attribute_2,
    cast(null as varchar(50)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
        -(locate(Audit_Text,'ov=')+length('ov=')))) = 'COMMPH1'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt not like 'New%') as b_old
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_old.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_old.adt_txt;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_PHONE_NUM_1' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),locate(Audit_Text,'inner =')-locate(Audit_Text,'v=')-3) = 'COMMPH1'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_new.adt_txt;
  commit work;
  update #temp_1 as a
    set Attribute_3 = b.Attribute_3 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select b_Row_Id,
      b_Customer_Id,
      b_Account_Id,
      b_Unique_Id,
      b_Category,
      b_Sub_Category,
      b_Source,
      b_Audit_Date,
      b_Attribute_1,
      b_Attribute_2,
      b_Attribute_3,
      b_Record_Creation_Date,
      b_Record_Modification_Date,
      b_Record_Valid_Flag,
      b_Gl_Sub_Head_Code,
      b_Rmks,
      b_Func_Code,
      b_Init_Sol_Id,
      b_Enterer_Id,
      b_Auth_Id,
      b_Table_Name,
      b_Auth_Sol_Id
      from(select a.customer_id as a_customer_id,
          a.Enterer_Id as a_Enterer_Id,
          a.Attribute_1 as a_Attribute_1,
          b.Row_Id as b_Row_Id,
          b.Customer_Id as b_Customer_Id,
          b.Account_Id as b_Account_Id,
          b.Unique_Id as b_Unique_Id,
          b.Category as b_Category,
          b.Sub_Category as b_Sub_Category,
          b.Source as b_Source,
          b.Audit_Date as b_Audit_Date,
          b.Attribute_1 as b_Attribute_1,
          b.Attribute_2 as b_Attribute_2,
          b.Attribute_3 as b_Attribute_3,
          b.Record_Creation_Date as b_Record_Creation_Date,
          b.Record_Modification_Date as b_Record_Modification_Date,
          b.Record_Valid_Flag as b_Record_Valid_Flag,
          b.Gl_Sub_Head_Code as b_Gl_Sub_Head_Code,
          b.Rmks as b_Rmks,
          b.Func_Code as b_Func_Code,
          b.Init_Sol_Id as b_Init_Sol_Id,
          b.Enterer_Id as b_Enterer_Id,
          b.Auth_Id as b_Auth_Id,
          b.Table_Name as b_Table_Name,
          b.Auth_Sol_Id as b_Auth_Sol_Id
          from #temp_1 as a right outer join #temp_2 as b
            on a.customer_id = b.customer_id
            and a.enterer_id = b.enterer_id
            and a.Attribute_1 = b.Attribute_1
          where(a_customer_id is null or a_Enterer_Id is null or a_Attribute_1 is null)) as x;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      from #temp_1;
  commit work;
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_PHONE_NUM_2' as varchar(100)) as Attribute_1,
    cast(substr(a.Audit_Text,locate(a.Audit_Text,'ov=')+length('ov='),((locate(a.Audit_Text,'inner =')-1)
    -(locate(a.Audit_Text,'ov=')+length('ov=')))) as varchar(100)) as Attribute_2,
    cast(null as varchar(50)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
        -(locate(Audit_Text,'ov=')+length('ov=')))) = 'COMMPH2'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt not like 'New%') as b_old
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_old.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_old.adt_txt;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_PHONE_NUM_2' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),locate(Audit_Text,'inner =')-locate(Audit_Text,'v=')-3) = 'COMMPH2'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_new.adt_txt;
  commit work;
  update #temp_1 as a
    set Attribute_3 = b.Attribute_3 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select b_Row_Id,
      b_Customer_Id,
      b_Account_Id,
      b_Unique_Id,
      b_Category,
      b_Sub_Category,
      b_Source,
      b_Audit_Date,
      b_Attribute_1,
      b_Attribute_2,
      b_Attribute_3,
      b_Record_Creation_Date,
      b_Record_Modification_Date,
      b_Record_Valid_Flag,
      b_Gl_Sub_Head_Code,
      b_Rmks,
      b_Func_Code,
      b_Init_Sol_Id,
      b_Enterer_Id,
      b_Auth_Id,
      b_Table_Name,
      b_Auth_Sol_Id
      from(select a.customer_id as a_customer_id,
          a.Enterer_Id as a_Enterer_Id,
          a.Attribute_1 as a_Attribute_1,
          b.Row_Id as b_Row_Id,
          b.Customer_Id as b_Customer_Id,
          b.Account_Id as b_Account_Id,
          b.Unique_Id as b_Unique_Id,
          b.Category as b_Category,
          b.Sub_Category as b_Sub_Category,
          b.Source as b_Source,
          b.Audit_Date as b_Audit_Date,
          b.Attribute_1 as b_Attribute_1,
          b.Attribute_2 as b_Attribute_2,
          b.Attribute_3 as b_Attribute_3,
          b.Record_Creation_Date as b_Record_Creation_Date,
          b.Record_Modification_Date as b_Record_Modification_Date,
          b.Record_Valid_Flag as b_Record_Valid_Flag,
          b.Gl_Sub_Head_Code as b_Gl_Sub_Head_Code,
          b.Rmks as b_Rmks,
          b.Func_Code as b_Func_Code,
          b.Init_Sol_Id as b_Init_Sol_Id,
          b.Enterer_Id as b_Enterer_Id,
          b.Auth_Id as b_Auth_Id,
          b.Table_Name as b_Table_Name,
          b.Auth_Sol_Id as b_Auth_Sol_Id
          from #temp_1 as a right outer join #temp_2 as b
            on a.customer_id = b.customer_id
            and a.enterer_id = b.enterer_id
            and a.Attribute_1 = b.Attribute_1
          where(a_customer_id is null or a_Enterer_Id is null or a_Attribute_1 is null)) as x;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      from #temp_1;
  commit work;
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_TELEX_NUM' as varchar(100)) as Attribute_1,
    cast(substr(a.Audit_Text,locate(a.Audit_Text,'ov=')+length('ov='),((locate(a.Audit_Text,'inner =')-1)
    -(locate(a.Audit_Text,'ov=')+length('ov=')))) as varchar(100)) as Attribute_2,
    cast(null as varchar(50)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
        -(locate(Audit_Text,'ov=')+length('ov=')))) = 'COMMTELEX'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt not like 'New%') as b_old
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_old.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_old.adt_txt;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id, ---  ----- 
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_TELEX_NUM' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),locate(Audit_Text,'inner =')-locate(Audit_Text,'v=')-3) = 'COMMTELEX'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_new.adt_txt;
  commit work;
  update #temp_1 as a
    set Attribute_3 = b.Attribute_3 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select b_Row_Id,
      b_Customer_Id,
      b_Account_Id,
      b_Unique_Id,
      b_Category,
      b_Sub_Category,
      b_Source,
      b_Audit_Date,
      b_Attribute_1,
      b_Attribute_2,
      b_Attribute_3,
      b_Record_Creation_Date,
      b_Record_Modification_Date,
      b_Record_Valid_Flag,
      b_Gl_Sub_Head_Code,
      b_Rmks,
      b_Func_Code,
      b_Init_Sol_Id,
      b_Enterer_Id,
      b_Auth_Id,
      b_Table_Name,
      b_Auth_Sol_Id
      from(select a.customer_id as a_customer_id,
          a.Enterer_Id as a_Enterer_Id,
          a.Attribute_1 as a_Attribute_1,
          b.Row_Id as b_Row_Id,
          b.Customer_Id as b_Customer_Id,
          b.Account_Id as b_Account_Id,
          b.Unique_Id as b_Unique_Id,
          b.Category as b_Category,
          b.Sub_Category as b_Sub_Category,
          b.Source as b_Source,
          b.Audit_Date as b_Audit_Date,
          b.Attribute_1 as b_Attribute_1,
          b.Attribute_2 as b_Attribute_2,
          b.Attribute_3 as b_Attribute_3,
          b.Record_Creation_Date as b_Record_Creation_Date,
          b.Record_Modification_Date as b_Record_Modification_Date,
          b.Record_Valid_Flag as b_Record_Valid_Flag,
          b.Gl_Sub_Head_Code as b_Gl_Sub_Head_Code,
          b.Rmks as b_Rmks,
          b.Func_Code as b_Func_Code,
          b.Init_Sol_Id as b_Init_Sol_Id,
          b.Enterer_Id as b_Enterer_Id,
          b.Auth_Id as b_Auth_Id,
          b.Table_Name as b_Table_Name,
          b.Auth_Sol_Id as b_Auth_Sol_Id
          from #temp_1 as a right outer join #temp_2 as b
            on a.customer_id = b.customer_id
            and a.enterer_id = b.enterer_id
            and a.Attribute_1 = b.Attribute_1
          where(a_customer_id is null or a_Enterer_Id is null or a_Attribute_1 is null)) as x;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      from #temp_1;
  commit work;
  drop table #temp_1; -------------
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_PHONE_NUM' as varchar(100)) as Attribute_1,
    cast(substr(a.Audit_Text,locate(a.Audit_Text,'ov=')+length('ov='),((locate(a.Audit_Text,'inner =')-1)
    -(locate(a.Audit_Text,'ov=')+length('ov=')))) as varchar(100)) as Attribute_2,
    cast(null as varchar(50)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
        -(locate(Audit_Text,'ov=')+length('ov=')))) = 'HOMEPH1'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt not like 'New%') as b_old
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_old.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_old.adt_txt;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_PHONE_NUM' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),locate(Audit_Text,'inner =')-locate(Audit_Text,'v=')-3) = 'HOMEPH1'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_new.adt_txt;
  commit work;
  update #temp_1 as a
    set Attribute_3 = b.Attribute_3 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select b_Row_Id,
      b_Customer_Id,
      b_Account_Id,
      b_Unique_Id,
      b_Category,
      b_Sub_Category,
      b_Source,
      b_Audit_Date,
      b_Attribute_1,
      b_Attribute_2,
      b_Attribute_3,
      b_Record_Creation_Date,
      b_Record_Modification_Date,
      b_Record_Valid_Flag,
      b_Gl_Sub_Head_Code,
      b_Rmks,
      b_Func_Code,
      b_Init_Sol_Id,
      b_Enterer_Id,
      b_Auth_Id,
      b_Table_Name,
      b_Auth_Sol_Id
      from(select a.customer_id as a_customer_id,
          a.Enterer_Id as a_Enterer_Id,
          a.Attribute_1 as a_Attribute_1,
          b.Row_Id as b_Row_Id,
          b.Customer_Id as b_Customer_Id,
          b.Account_Id as b_Account_Id,
          b.Unique_Id as b_Unique_Id,
          b.Category as b_Category,
          b.Sub_Category as b_Sub_Category,
          b.Source as b_Source,
          b.Audit_Date as b_Audit_Date,
          b.Attribute_1 as b_Attribute_1,
          b.Attribute_2 as b_Attribute_2,
          b.Attribute_3 as b_Attribute_3,
          b.Record_Creation_Date as b_Record_Creation_Date,
          b.Record_Modification_Date as b_Record_Modification_Date,
          b.Record_Valid_Flag as b_Record_Valid_Flag,
          b.Gl_Sub_Head_Code as b_Gl_Sub_Head_Code,
          b.Rmks as b_Rmks,
          b.Func_Code as b_Func_Code,
          b.Init_Sol_Id as b_Init_Sol_Id,
          b.Enterer_Id as b_Enterer_Id,
          b.Auth_Id as b_Auth_Id,
          b.Table_Name as b_Table_Name,
          b.Auth_Sol_Id as b_Auth_Sol_Id
          from #temp_1 as a right outer join #temp_2 as b
            on a.customer_id = b.customer_id
            and a.enterer_id = b.enterer_id
            and a.Attribute_1 = b.Attribute_1
          where(a_customer_id is null or a_Enterer_Id is null or a_Attribute_1 is null)) as x;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      from #temp_1;
  commit work;
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_TELEX_NUM' as varchar(100)) as Attribute_1,
    cast(substr(a.Audit_Text,locate(a.Audit_Text,'ov=')+length('ov='),((locate(a.Audit_Text,'inner =')-1)
    -(locate(a.Audit_Text,'ov=')+length('ov=')))) as varchar(100)) as Attribute_2,
    cast(null as varchar(50)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
        -(locate(Audit_Text,'ov=')+length('ov=')))) = 'HOMETELEX'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt not like 'New%') as b_old
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_old.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_old.adt_txt;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_TELEX_NUM' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),locate(Audit_Text,'inner =')-locate(Audit_Text,'v=')-3) = 'HOMETELEX'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_new.adt_txt;
  commit work;
  update #temp_1 as a
    set Attribute_3 = b.Attribute_3 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select b_Row_Id,
      b_Customer_Id,
      b_Account_Id,
      b_Unique_Id,
      b_Category,
      b_Sub_Category,
      b_Source,
      b_Audit_Date,
      b_Attribute_1,
      b_Attribute_2,
      b_Attribute_3,
      b_Record_Creation_Date,
      b_Record_Modification_Date,
      b_Record_Valid_Flag,
      b_Gl_Sub_Head_Code,
      b_Rmks,
      b_Func_Code,
      b_Init_Sol_Id,
      b_Enterer_Id,
      b_Auth_Id,
      b_Table_Name,
      b_Auth_Sol_Id
      from(select a.customer_id as a_customer_id,
          a.Enterer_Id as a_Enterer_Id,
          a.Attribute_1 as a_Attribute_1,
          b.Row_Id as b_Row_Id,
          b.Customer_Id as b_Customer_Id,
          b.Account_Id as b_Account_Id,
          b.Unique_Id as b_Unique_Id,
          b.Category as b_Category,
          b.Sub_Category as b_Sub_Category,
          b.Source as b_Source,
          b.Audit_Date as b_Audit_Date,
          b.Attribute_1 as b_Attribute_1,
          b.Attribute_2 as b_Attribute_2,
          b.Attribute_3 as b_Attribute_3,
          b.Record_Creation_Date as b_Record_Creation_Date,
          b.Record_Modification_Date as b_Record_Modification_Date,
          b.Record_Valid_Flag as b_Record_Valid_Flag,
          b.Gl_Sub_Head_Code as b_Gl_Sub_Head_Code,
          b.Rmks as b_Rmks,
          b.Func_Code as b_Func_Code,
          b.Init_Sol_Id as b_Init_Sol_Id,
          b.Enterer_Id as b_Enterer_Id,
          b.Auth_Id as b_Auth_Id,
          b.Table_Name as b_Table_Name,
          b.Auth_Sol_Id as b_Auth_Sol_Id
          from #temp_1 as a right outer join #temp_2 as b
            on a.customer_id = b.customer_id
            and a.enterer_id = b.enterer_id
            and a.Attribute_1 = b.Attribute_1
          where(a_customer_id is null or a_Enterer_Id is null or a_Attribute_1 is null)) as x;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      from #temp_1;
  commit work;
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_FAX_NO' as varchar(100)) as Attribute_1,
    cast(substr(a.Audit_Text,locate(a.Audit_Text,'ov=')+length('ov='),((locate(a.Audit_Text,'inner =')-1)
    -(locate(a.Audit_Text,'ov=')+length('ov=')))) as varchar(100)) as Attribute_2,
    cast(null as varchar(50)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
        -(locate(Audit_Text,'ov=')+length('ov=')))) = 'FAX1'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt not like 'New%') as b_old
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_old.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_old.adt_txt;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    cast('Contact number' as varchar(100)) as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_FAX_NO' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
        -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),locate(Audit_Text,'inner =')-locate(Audit_Text,'v=')-3) = 'FAX1'
        and audit_text like '%inner =PhoneEmail%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =PhoneEmail%'
    and locate(a.Audit_Text,'PhoneNo ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
    -(locate(a.Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) = b_new.adt_txt;
  commit work;
  update #temp_1 as a
    set Attribute_3 = b.Attribute_3 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select b_Row_Id,
      b_Customer_Id,
      b_Account_Id,
      b_Unique_Id,
      b_Category,
      b_Sub_Category,
      b_Source,
      b_Audit_Date,
      b_Attribute_1,
      b_Attribute_2,
      b_Attribute_3,
      b_Record_Creation_Date,
      b_Record_Modification_Date,
      b_Record_Valid_Flag,
      b_Gl_Sub_Head_Code,
      b_Rmks,
      b_Func_Code,
      b_Init_Sol_Id,
      b_Enterer_Id,
      b_Auth_Id,
      b_Table_Name,
      b_Auth_Sol_Id
      from(select a.customer_id as a_customer_id,
          a.Enterer_Id as a_Enterer_Id,
          a.Attribute_1 as a_Attribute_1,
          b.Row_Id as b_Row_Id,
          b.Customer_Id as b_Customer_Id,
          b.Account_Id as b_Account_Id,
          b.Unique_Id as b_Unique_Id,
          b.Category as b_Category,
          b.Sub_Category as b_Sub_Category,
          b.Source as b_Source,
          b.Audit_Date as b_Audit_Date,
          b.Attribute_1 as b_Attribute_1,
          b.Attribute_2 as b_Attribute_2,
          b.Attribute_3 as b_Attribute_3,
          b.Record_Creation_Date as b_Record_Creation_Date,
          b.Record_Modification_Date as b_Record_Modification_Date,
          b.Record_Valid_Flag as b_Record_Valid_Flag,
          b.Gl_Sub_Head_Code as b_Gl_Sub_Head_Code,
          b.Rmks as b_Rmks,
          b.Func_Code as b_Func_Code,
          b.Init_Sol_Id as b_Init_Sol_Id,
          b.Enterer_Id as b_Enterer_Id,
          b.Auth_Id as b_Auth_Id,
          b.Table_Name as b_Table_Name,
          b.Auth_Sol_Id as b_Auth_Sol_Id
          from #temp_1 as a right outer join #temp_2 as b
            on a.customer_id = b.customer_id
            and a.enterer_id = b.enterer_id
            and a.Attribute_1 = b.Attribute_1
          where(a_customer_id is null or a_Enterer_Id is null or a_Attribute_1 is null)) as x;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      from #temp_1;
  commit work;
  ------------------------------------------------------------------------------------------------------------------------------------------------
  ------------------------------------------------------------------------------------------------------------------------------------------------
  ------------------------------------------------------------------------------------------------------------------------------------------------
  ------------------------------------------------------------------------------------------------------------------------------------------------
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  -- Address1 Mailing
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct address1,cust_id as customer_id,enterer_id,'CUST_COMU_ADDR1' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%mailing$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line1 ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Mailing';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Comu address' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_ADDR1' as varchar(100)) as Attribute_1,
    cast(null as varchar(100)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Mailing$')+length('Mailing$'),locate(Audit_Text,'$',(locate(Audit_Text,'Mailing$')+length('Mailing$')))
        -(locate(Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line1 ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) = b_new.adt_txt
    and a.Audit_Text like '%Mailing$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = address1 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  -- Address2 Mailing
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct address2,cust_id as customer_id,enterer_id,'CUST_COMU_ADDR2' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%mailing$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line2 ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Mailing';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Comu address' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_ADDR2' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Mailing$')+length('Mailing$'),locate(Audit_Text,'$',(locate(Audit_Text,'Mailing$')+length('Mailing$')))
        -(locate(Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line2 ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) = b_new.adt_txt
    and a.Audit_Text like '%Mailing$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = address2 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ------
  -- Address1 Mailing
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct pin_code,cust_id as customer_id,enterer_id,'CUST_COMU_PIN_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%mailing$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'zip ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Mailing';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Pincode' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_PIN_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Mailing$')+length('Mailing$'),locate(Audit_Text,'$',(locate(Audit_Text,'Mailing$')+length('Mailing$')))
        -(locate(Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'zip ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) = b_new.adt_txt
    and a.Audit_Text like '%Mailing$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = pin_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  ------
  -- Address1 Mailing
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct city_code,cust_id as customer_id,enterer_id,'CUST_COMU_CITY_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%mailing$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'city ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Mailing';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'City' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_CITY_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Mailing$')+length('Mailing$'),locate(Audit_Text,'$',(locate(Audit_Text,'Mailing$')+length('Mailing$')))
        -(locate(Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'city ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) = b_new.adt_txt
    and a.Audit_Text like '%Mailing$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = city_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  ------
  -- Address1 Mailing
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cntry_code,cust_id as customer_id,enterer_id,'CUST_COMU_CNTRY_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%mailing$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'country ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Mailing';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Country' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_CNTRY_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Mailing$')+length('Mailing$'),locate(Audit_Text,'$',(locate(Audit_Text,'Mailing$')+length('Mailing$')))
        -(locate(Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'country ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) = b_new.adt_txt
    and a.Audit_Text like '%Mailing$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = cntry_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  ------
  -- Address1 Mailing
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct state_code,cust_id as customer_id,enterer_id,'CUST_COMU_STATE_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%mailing$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'state ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Mailing';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'State' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_COMU_STATE_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Mailing$')+length('Mailing$'),locate(Audit_Text,'$',(locate(Audit_Text,'Mailing$')+length('Mailing$')))
        -(locate(Audit_Text,'Mailing$')+length('Mailing$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'state ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Mailing$')+length('Mailing$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Mailing$')+length('Mailing$')))
    -(locate(a.Audit_Text,'Mailing$')+length('Mailing$'))) = b_new.adt_txt
    and a.Audit_Text like '%Mailing$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = state_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  -----
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  -- Address1 Home
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct address1,cust_id as customer_id,enterer_id,'CUST_PERM_ADDR1' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Home$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line1 ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Home';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Perm address' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_ADDR1' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Home$')+length('Home$'),locate(Audit_Text,'$',(locate(Audit_Text,'Home$')+length('Home$')))
        -(locate(Audit_Text,'Home$')+length('Home$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line1 ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) = b_new.adt_txt
    and a.Audit_Text like '%Home$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = address1 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  -- Address2 Home
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct address2,cust_id as customer_id,enterer_id,'CUST_PERM_ADDR2' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Home$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line2 ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Home';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Perm address' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_ADDR2' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Home$')+length('Home$'),locate(Audit_Text,'$',(locate(Audit_Text,'Home$')+length('Home$')))
        -(locate(Audit_Text,'Home$')+length('Home$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line2 ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) = b_new.adt_txt
    and a.Audit_Text like '%Home$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = address2 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ------
  -- Address1 Home
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct pin_code,cust_id as customer_id,enterer_id,'CUST_PERM_PIN_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Home$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'zip ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Home';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Pincode' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_PIN_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Home$')+length('Home$'),locate(Audit_Text,'$',(locate(Audit_Text,'Home$')+length('Home$')))
        -(locate(Audit_Text,'Home$')+length('Home$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'zip ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) = b_new.adt_txt
    and a.Audit_Text like '%Home$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = pin_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  ------
  -- Address1 Home
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct city_code,cust_id as customer_id,enterer_id,'CUST_PERM_CITY_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Home$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'city ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Home';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'City' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_CITY_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Home$')+length('Home$'),locate(Audit_Text,'$',(locate(Audit_Text,'Home$')+length('Home$')))
        -(locate(Audit_Text,'Home$')+length('Home$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'city ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) = b_new.adt_txt
    and a.Audit_Text like '%Home$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = city_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  ------
  -- Address1 Home
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cntry_code,cust_id as customer_id,enterer_id,'CUST_PERM_CNTRY_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Home$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'country ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Home';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Country' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_CNTRY_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Home$')+length('Home$'),locate(Audit_Text,'$',(locate(Audit_Text,'Home$')+length('Home$')))
        -(locate(Audit_Text,'Home$')+length('Home$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'country ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) = b_new.adt_txt
    and a.Audit_Text like '%Home$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = cntry_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  ------
  -- Address1 Home
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct state_code,cust_id as customer_id,enterer_id,'CUST_PERM_STATE_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Home$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'state ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Home';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'State' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_PERM_STATE_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Home$')+length('Home$'),locate(Audit_Text,'$',(locate(Audit_Text,'Home$')+length('Home$')))
        -(locate(Audit_Text,'Home$')+length('Home$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'state ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Home$')+length('Home$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Home$')+length('Home$')))
    -(locate(a.Audit_Text,'Home$')+length('Home$'))) = b_new.adt_txt
    and a.Audit_Text like '%Home$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = state_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  -----
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  -- Address1 Work
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct address1,cust_id as customer_id,enterer_id,'CUST_EMP_ADDR1' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Work$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line1 ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Work';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Emp address' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_EMP_ADDR1' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Work$')+length('Work$'),locate(Audit_Text,'$',(locate(Audit_Text,'Work$')+length('Work$')))
        -(locate(Audit_Text,'Work$')+length('Work$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line1 ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) = b_new.adt_txt
    and a.Audit_Text like '%Work$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = address1 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  -- Address2 Work
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct address2,cust_id as customer_id,enterer_id,'CUST_EMP_ADDR2' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Work$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line2 ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Work';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Emp address' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_EMP_ADDR2' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Work$')+length('Work$'),locate(Audit_Text,'$',(locate(Audit_Text,'Work$')+length('Work$')))
        -(locate(Audit_Text,'Work$')+length('Work$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'address_Line2 ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) = b_new.adt_txt
    and a.Audit_Text like '%Work$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = address2 from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ------
  -- Address1 Work
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct pin_code,cust_id as customer_id,enterer_id,'CUST_EMP_PIN_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Work$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'zip ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Work';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Pincode' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_EMP_PIN_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Work$')+length('Work$'),locate(Audit_Text,'$',(locate(Audit_Text,'Work$')+length('Work$')))
        -(locate(Audit_Text,'Work$')+length('Work$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'zip ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) = b_new.adt_txt
    and a.Audit_Text like '%Work$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = pin_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  ------
  -- Address1 Work
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct city_code,cust_id as customer_id,enterer_id,'CUST_EMP_CITY_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Work$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'city ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Work';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'City' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_EMP_CITY_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Work$')+length('Work$'),locate(Audit_Text,'$',(locate(Audit_Text,'Work$')+length('Work$')))
        -(locate(Audit_Text,'Work$')+length('Work$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'city ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) = b_new.adt_txt
    and a.Audit_Text like '%Work$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = city_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  ------
  -- Address1 Work
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct cntry_code,cust_id as customer_id,enterer_id,'CUST_EMP_CNTRY_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Work$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'country ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Work';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'Country' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_EMP_CNTRY_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Work$')+length('Work$'),locate(Audit_Text,'$',(locate(Audit_Text,'Work$')+length('Work$')))
        -(locate(Audit_Text,'Work$')+length('Work$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'country ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) = b_new.adt_txt
    and a.Audit_Text like '%Work$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = cntry_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  ------
  -- Address1 Work
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  commit work;
  select distinct state_code,cust_id as customer_id,enterer_id,'CUST_EMP_STATE_CODE' as attribute_1
    into #temp_1
    from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_address as b
      ,(select cast(substr(audit_text,locate(audit_text,' v=')+9,4) || '-' || substr(audit_text,locate(audit_text,' v=')+6,2)
         || '-' || substr(audit_text,locate(audit_text,' v=')+3,2) as date) as End_Date
        from #ADT_CMG_PRE_PROCESS_Intrdy where audit_text like '%inner =Address%'
        and audit_text like '%Work$%' and audit_text not like '%New%' and audit_text like '%$End_Date%'
        and substr(audit_text,locate(audit_text,' v=')+5,1) = '/') as x
    where trim(a.cust_id) = b.addr_b2kid
    and audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'state ') >= 1
    and x.end_date = b.End_Date
    and b.addr_id = 'Work';
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    cast('Address' as varchar(100)) as Category,
    'State' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('CUST_EMP_STATE_CODE' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast((case when substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) like 'New%' then
      substr(a.Audit_Text,locate(a.Audit_Text,'v=')+length('v='),locate(a.Audit_Text,'inner =')-locate(a.Audit_Text,'v=')-3)
    end) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id,
    substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) as adt_txt
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select Audit_Text,cust_id,substr(Audit_Text,locate(Audit_Text,'Work$')+length('Work$'),locate(Audit_Text,'$',(locate(Audit_Text,'Work$')+length('Work$')))
        -(locate(Audit_Text,'Work$')+length('Work$'))) as adt_txt
        from #ADT_CMG_PRE_PROCESS_Intrdy
        where audit_text like '%inner =Address%'
        and adt_txt like 'New%') as b_new
    where a.audit_text like '%inner =Address%'
    and locate(a.Audit_Text,'state ') >= 1
    and a.cust_id = b_new.cust_id
    and substr(a.Audit_Text,locate(a.Audit_Text,'Work$')+length('Work$'),locate(a.Audit_Text,'$',(locate(a.Audit_Text,'Work$')+length('Work$')))
    -(locate(a.Audit_Text,'Work$')+length('Work$'))) = b_new.adt_txt
    and a.Audit_Text like '%Work$%';
  commit work;
  update #temp_2 as b
    set Attribute_2 = state_code from
    #temp_1 as a,#temp_2 as b
    where a.customer_id = b.customer_id
    and a.enterer_id = b.enterer_id
    and a.Attribute_1 = b.Attribute_1;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----
  -----
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  insert into #temp_cmg_attrib
    select distinct cast(null as numeric(30)) as Row_Id,
      a.cust_id as Customer_Id,
      cast(a.auditedid as varchar) as Account_Id,
      cast(null as varchar(50)) as Unique_Id,
      cast('Address' as varchar(100)) as Category,
      cast('Contact number' as varchar(100)) as Sub_Category,
      cast('ADT' as varchar(100)) as Source,
      isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
      'CUST_PAGER_NO' as Attribute_1,
      substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
      -(locate(Audit_Text,'ov=')+length('ov=')))) as Value_Old,
      substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),((locate(Audit_Text,'inner =')-(length(Value_Old)+length(' ov=')+1))
      -(locate(Audit_Text,'v=')+length('v=')))) as Value_New,
      a.bodatecreated as Record_Creation_Date,
      a.bodatemodified as Record_Modification_Date,
      'Y' as Record_Valid_Flag,
      cast(null as varchar(50)) as Gl_Sub_Head_Code,
      cast(null as varchar(50)) as Rmks,
      cast(null as varchar(50)) as Func_Code,
      cast(null as varchar(50)) as Init_Sol_Id,
      a.Enterer_Id,
      cast(a.bomodifiedby as varchar(50)) as Auth_Id,
      'CMG' as Table_Name,
      cast(null as varchar(50)) as Auth_Sol_Id
      from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_phoneemail_intrdy as b
      where trim(a.cust_id) = b.orgkey
      and audit_text like '%Phoneemail%'
      and locate(Audit_Text,'PhoneNo v') >= 1
      and substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) not like 'New%'
      and cast(substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as numeric(38)) = phoneemailid
      and phoneemailtype = 'CELLPH';
  commit work;
  insert into #temp_cmg_attrib
    select distinct cast(null as numeric(30)) as Row_Id,
      a.cust_id as Customer_Id,
      cast(a.auditedid as varchar) as Account_Id,
      cast(null as varchar(50)) as Unique_Id,
      cast('Address' as varchar(100)) as Category,
      cast('Contact number' as varchar(100)) as Sub_Category,
      cast('ADT' as varchar(100)) as Source,
      isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
      'CUST_PERM_PHONE_NUM' as Attribute_1,
      substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
      -(locate(Audit_Text,'ov=')+length('ov=')))) as Value_Old,
      substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),((locate(Audit_Text,'inner =')-(length(Value_Old)+length(' ov=')+1))
      -(locate(Audit_Text,'v=')+length('v=')))) as Value_New,
      a.bodatecreated as Record_Creation_Date,
      a.bodatemodified as Record_Modification_Date,
      'Y' as Record_Valid_Flag,
      cast(null as varchar(50)) as Gl_Sub_Head_Code,
      cast(null as varchar(50)) as Rmks,
      cast(null as varchar(50)) as Func_Code,
      cast(null as varchar(50)) as Init_Sol_Id,
      a.Enterer_Id,
      cast(a.bomodifiedby as varchar(50)) as Auth_Id,
      'CMG' as Table_Name,
      cast(null as varchar(50)) as Auth_Sol_Id
      from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_phoneemail_intrdy as b
      where trim(a.cust_id) = b.orgkey
      and audit_text like '%Phoneemail%'
      and locate(Audit_Text,'PhoneNo v') >= 1
      and substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) not like 'New%'
      and cast(substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as numeric(38)) = phoneemailid
      and phoneemailtype = 'HOMEPH1';
  commit work;
  insert into #temp_cmg_attrib
    select distinct cast(null as numeric(30)) as Row_Id,
      a.cust_id as Customer_Id,
      cast(a.auditedid as varchar) as Account_Id,
      cast(null as varchar(50)) as Unique_Id,
      cast('Address' as varchar(100)) as Category,
      cast('Contact number' as varchar(100)) as Sub_Category,
      cast('ADT' as varchar(100)) as Source,
      isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
      'CUST_PERM_TELEX_NUM' as Attribute_1,
      substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
      -(locate(Audit_Text,'ov=')+length('ov=')))) as Value_Old,
      substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),((locate(Audit_Text,'inner =')-(length(Value_Old)+length(' ov=')+1))
      -(locate(Audit_Text,'v=')+length('v=')))) as Value_New,
      a.bodatecreated as Record_Creation_Date,
      a.bodatemodified as Record_Modification_Date,
      'Y' as Record_Valid_Flag,
      cast(null as varchar(50)) as Gl_Sub_Head_Code,
      cast(null as varchar(50)) as Rmks,
      cast(null as varchar(50)) as Func_Code,
      cast(null as varchar(50)) as Init_Sol_Id,
      a.Enterer_Id,
      cast(a.bomodifiedby as varchar(50)) as Auth_Id,
      'CMG' as Table_Name,
      cast(null as varchar(50)) as Auth_Sol_Id
      from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_phoneemail_intrdy as b
      where trim(a.cust_id) = b.orgkey
      and audit_text like '%Phoneemail%'
      and locate(Audit_Text,'PhoneNo v') >= 1
      and substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) not like 'New%'
      and cast(substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as numeric(38)) = phoneemailid
      and phoneemailtype = 'HOMETELEX';
  commit work;
  insert into #temp_cmg_attrib
    select distinct cast(null as numeric(30)) as Row_Id,
      a.cust_id as Customer_Id,
      cast(a.auditedid as varchar) as Account_Id,
      cast(null as varchar(50)) as Unique_Id,
      cast('Address' as varchar(100)) as Category,
      cast('Contact number' as varchar(100)) as Sub_Category,
      cast('ADT' as varchar(100)) as Source,
      isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
      'CUST_COMU_PHONE_NUM_1' as Attribute_1,
      substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
      -(locate(Audit_Text,'ov=')+length('ov=')))) as Value_Old,
      substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),((locate(Audit_Text,'inner =')-(length(Value_Old)+length(' ov=')+1))
      -(locate(Audit_Text,'v=')+length('v=')))) as Value_New,
      a.bodatecreated as Record_Creation_Date,
      a.bodatemodified as Record_Modification_Date,
      'Y' as Record_Valid_Flag,
      cast(null as varchar(50)) as Gl_Sub_Head_Code,
      cast(null as varchar(50)) as Rmks,
      cast(null as varchar(50)) as Func_Code,
      cast(null as varchar(50)) as Init_Sol_Id,
      a.Enterer_Id,
      cast(a.bomodifiedby as varchar(50)) as Auth_Id,
      'CMG' as Table_Name,
      cast(null as varchar(50)) as Auth_Sol_Id
      from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_phoneemail_intrdy as b
      where trim(a.cust_id) = b.orgkey
      and audit_text like '%Phoneemail%'
      and locate(Audit_Text,'PhoneNo v') >= 1
      and substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) not like 'New%'
      and cast(substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as numeric(38)) = phoneemailid
      and phoneemailtype = 'COMMPH1';
  commit work;
  insert into #temp_cmg_attrib
    select distinct cast(null as numeric(30)) as Row_Id,
      a.cust_id as Customer_Id,
      cast(a.auditedid as varchar) as Account_Id,
      cast(null as varchar(50)) as Unique_Id,
      cast('Address' as varchar(100)) as Category,
      cast('Contact number' as varchar(100)) as Sub_Category,
      cast('ADT' as varchar(100)) as Source,
      isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
      'CUST_COMU_PHONE_NUM_2' as Attribute_1,
      substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
      -(locate(Audit_Text,'ov=')+length('ov=')))) as Value_Old,
      substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),((locate(Audit_Text,'inner =')-(length(Value_Old)+length(' ov=')+1))
      -(locate(Audit_Text,'v=')+length('v=')))) as Value_New,
      a.bodatecreated as Record_Creation_Date,
      a.bodatemodified as Record_Modification_Date,
      'Y' as Record_Valid_Flag,
      cast(null as varchar(50)) as Gl_Sub_Head_Code,
      cast(null as varchar(50)) as Rmks,
      cast(null as varchar(50)) as Func_Code,
      cast(null as varchar(50)) as Init_Sol_Id,
      a.Enterer_Id,
      cast(a.bomodifiedby as varchar(50)) as Auth_Id,
      'CMG' as Table_Name,
      cast(null as varchar(50)) as Auth_Sol_Id
      from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_phoneemail_intrdy as b
      where trim(a.cust_id) = b.orgkey
      and audit_text like '%Phoneemail%'
      and locate(Audit_Text,'PhoneNo v') >= 1
      and substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) not like 'New%'
      and cast(substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as numeric(38)) = phoneemailid
      and phoneemailtype = 'COMMPH2';
  commit work;
  insert into #temp_cmg_attrib
    select distinct cast(null as numeric(30)) as Row_Id,
      a.cust_id as Customer_Id,
      cast(a.auditedid as varchar) as Account_Id,
      cast(null as varchar(50)) as Unique_Id,
      cast('Address' as varchar(100)) as Category,
      cast('Contact number' as varchar(100)) as Sub_Category,
      cast('ADT' as varchar(100)) as Source,
      isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
      'CUST_COMU_TELEX_NUM' as Attribute_1,
      substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
      -(locate(Audit_Text,'ov=')+length('ov=')))) as Value_Old,
      substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),((locate(Audit_Text,'inner =')-(length(Value_Old)+length(' ov=')+1))
      -(locate(Audit_Text,'v=')+length('v=')))) as Value_New,
      a.bodatecreated as Record_Creation_Date,
      a.bodatemodified as Record_Modification_Date,
      'Y' as Record_Valid_Flag,
      cast(null as varchar(50)) as Gl_Sub_Head_Code,
      cast(null as varchar(50)) as Rmks,
      cast(null as varchar(50)) as Func_Code,
      cast(null as varchar(50)) as Init_Sol_Id,
      a.Enterer_Id,
      cast(a.bomodifiedby as varchar(50)) as Auth_Id,
      'CMG' as Table_Name,
      cast(null as varchar(50)) as Auth_Sol_Id
      from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_phoneemail_intrdy as b
      where trim(a.cust_id) = b.orgkey
      and audit_text like '%Phoneemail%'
      and locate(Audit_Text,'PhoneNo v') >= 1
      and substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) not like 'New%'
      and cast(substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as numeric(38)) = phoneemailid
      and phoneemailtype = 'COMMTELEX';
  commit work;
  insert into #temp_cmg_attrib
    select distinct cast(null as numeric(30)) as Row_Id,
      a.cust_id as Customer_Id,
      cast(a.auditedid as varchar) as Account_Id,
      cast(null as varchar(50)) as Unique_Id,
      cast('Address' as varchar(100)) as Category,
      cast('Contact number' as varchar(100)) as Sub_Category,
      cast('ADT' as varchar(100)) as Source,
      isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
      'CUST_FAX_NO' as Attribute_1,
      substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
      -(locate(Audit_Text,'ov=')+length('ov=')))) as Value_Old,
      substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),((locate(Audit_Text,'inner =')-(length(Value_Old)+length(' ov=')+1))
      -(locate(Audit_Text,'v=')+length('v=')))) as Value_New,
      a.bodatecreated as Record_Creation_Date,
      a.bodatemodified as Record_Modification_Date,
      'Y' as Record_Valid_Flag,
      cast(null as varchar(50)) as Gl_Sub_Head_Code,
      cast(null as varchar(50)) as Rmks,
      cast(null as varchar(50)) as Func_Code,
      cast(null as varchar(50)) as Init_Sol_Id,
      a.Enterer_Id,
      cast(a.bomodifiedby as varchar(50)) as Auth_Id,
      'CMG' as Table_Name,
      cast(null as varchar(50)) as Auth_Sol_Id
      from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_phoneemail_intrdy as b
      where trim(a.cust_id) = b.orgkey
      and audit_text like '%Phoneemail%'
      and locate(Audit_Text,'PhoneNo v') >= 1
      and substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) not like 'New%'
      and cast(substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as numeric(38)) = phoneemailid
      and phoneemailtype = 'FAX1';
  commit work;
  insert into #temp_cmg_attrib
    select distinct cast(null as numeric(30)) as Row_Id,
      a.cust_id as Customer_Id,
      cast(a.auditedid as varchar) as Account_Id,
      cast(null as varchar(50)) as Unique_Id,
      cast('Address' as varchar(100)) as Category,
      cast('Email' as varchar(100)) as Sub_Category,
      cast('ADT' as varchar(100)) as Source,
      isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
      'EMAIL_ID' as Attribute_1,
      substr(Audit_Text,locate(Audit_Text,'ov=')+length('ov='),((locate(Audit_Text,'inner =')-1)
      -(locate(Audit_Text,'ov=')+length('ov=')))) as Value_Old,
      substr(Audit_Text,locate(Audit_Text,'v=')+length('v='),((locate(Audit_Text,'inner =')-(length(Value_Old)+length(' ov=')+1))
      -(locate(Audit_Text,'v=')+length('v=')))) as Value_New,
      a.bodatecreated as Record_Creation_Date,
      a.bodatemodified as Record_Modification_Date,
      'Y' as Record_Valid_Flag,
      cast(null as varchar(50)) as Gl_Sub_Head_Code,
      cast(null as varchar(50)) as Rmks,
      cast(null as varchar(50)) as Func_Code,
      cast(null as varchar(50)) as Init_Sol_Id,
      a.Enterer_Id,
      cast(a.bomodifiedby as varchar(50)) as Auth_Id,
      'CMG' as Table_Name,
      cast(null as varchar(50)) as Auth_Sol_Id
      from #ADT_CMG_PRE_PROCESS_Intrdy as a,srcstage.cmg_phoneemail_intrdy as b
      where trim(a.cust_id) = b.orgkey
      and audit_text like '%Phoneemail%'
      and locate(Audit_Text,'$Email v') >= 1
      and substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) not like 'New%'
      and cast(substr(Audit_Text,locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'),locate(Audit_Text,'$',(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$')))
      -(locate(Audit_Text,'PhoneEmail$')+length('PhoneEmail$'))) as numeric(38)) = phoneemailid
      and phoneemailtype = 'COMMEML';
  commit work;
  ----------------------------------------------------------------------
  drop table #temp_1;
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Adhar' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('ADHAR_NO' as varchar(100)) as Attribute_1,
    cast(null as varchar(50)) as Attribute_2,
    cast(new_val as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
      ,(select cust_id,enterer_id,substr(Audit_Text,locate(Audit_Text,'v=')+2,
        (locate(Audit_Text,'/>')-1)-(locate(Audit_Text,'v=')+1)) as new_val
        from #ADT_CMG_PRE_PROCESS_Intrdy where Audit_text like '%ReferenceNumber%' and Audit_text not like '%ov=%' and new_val not like '%[A-Z]%') as b
    where a.Audit_Text like '%DocTypeCode v=UID%'
    and customer_id = b.cust_id
    and a.enterer_id = b.enterer_id;
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------------------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Entity_Cre_Flg' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('ENTITY_CRE_FLG' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-1)-(locate(Audit_Text,'v=')+2)) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-1)-(locate(Audit_Text,'ov=')+2)) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%entity_cre_flg%' and a.audit_text not like '%Miscellaneous%' and a.Audit_Text like '%ov=%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------------------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id, -- 
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Cust_Dob' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('DATE_OF_BIRTH' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-1)-(locate(Audit_Text,'v=')+2)) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-1)-(locate(Audit_Text,'ov=')+2)) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%cust_dob%' and a.audit_text not like '%Miscellaneous%' and a.Audit_Text like '%ov=%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ------------------------------------------------------------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Panno' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('PAN_GIR_NUM' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-1)-(locate(Audit_Text,'v=')+2)) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-1)-(locate(Audit_Text,'ov=')+2)) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%pan v=%' and a.audit_text not like '%Miscellaneous%' and a.Audit_Text like '%ov=%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -----------------------------------------------------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Marital_Status' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('MARITAL_STATUS' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-1)-(locate(Audit_Text,'v=')+2)) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-1)-(locate(Audit_Text,'ov=')+2)) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%marital_status v=%' and a.audit_text not like '%Miscellaneous%' and a.Audit_Text like '%ov=%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Cust_Const_Code' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Cust_Const_Code' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Cust_Const_Code v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Cust_commu_code' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Cust_commu_code' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Cust_commu_code v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'PrimarySolID' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('PrimarySolID' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%PrimarySolID v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Cust_community' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Cust_community' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Cust_community v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Cust_First_Name' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Cust_First_Name' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Cust_First_Name v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Cust_Last_Name' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Cust_Last_Name' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Cust_Last_Name v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Cust_Middle_Name' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Cust_Middle_Name' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Cust_Middle_Name v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Email_Home' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Email_Home' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Email_Home v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Nationality' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Nationality' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Nationality v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Occupation' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Occupation' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Occupation v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'PassportNo' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('PassportNo' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%PassportNo v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Phone_Home' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Phone_Home' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Phone_Home v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'Salutation' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('Salutation' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%Salutation v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  ---------------------------
  -------------------------------
  drop table #temp_2;
  commit work;
  select distinct cast(null as numeric(20)) as Row_Id,
    a.cust_id as Customer_Id,
    cast(a.auditedid as varchar) as Account_Id,
    cast(null as varchar(50)) as Unique_Id,
    'Demog_Other' as Category,
    'short_name' as Sub_Category,
    cast('ADT' as varchar(100)) as Source,
    isnull(a.BODATEMODIFIED,a.bodatecreated,a.BODATEMODIFIED) as Audit_Date,
    cast('short_name' as varchar(100)) as Attribute_1,
    cast(substr(Audit_Text,locate(Audit_Text,'v=')+2,(locate(Audit_Text,'ov=')-3)-(locate(Audit_Text,'v='))) as varchar(100)) as Attribute_2,
    cast(substr(Audit_Text,locate(Audit_Text,'ov=')+3,(locate(Audit_Text,'/>')-3)-(locate(Audit_Text,'ov='))) as varchar(100)) as Attribute_3,
    a.bodatecreated as Record_Creation_Date,
    a.bodatemodified as Record_Modification_Date,
    'Y' as Record_Valid_Flag,
    cast(null as varchar(50)) as Gl_Sub_Head_Code,
    cast(null as varchar(50)) as Rmks,
    cast(null as varchar(50)) as Func_Code,
    cast(null as varchar(50)) as Init_Sol_Id,
    a.Enterer_Id,
    cast(a.bomodifiedby as varchar) as Auth_Id,
    'CMG' as Table_Name,
    cast(null as varchar(50)) as Auth_Sol_Id
    into #temp_2
    from #ADT_CMG_PRE_PROCESS_Intrdy as a
    where a.Audit_Text like '%short_name v=%'
    and audit_text like '%n=%'
    and audit_text like '%v=%'
    and audit_text like '%ov=%'
    and length(substr(audit_text,locate(audit_text,'v=')+2,
    (locate(audit_text,'ov=')-3)-(locate(audit_text,'v=')))) > 1
    and audit_text not like '%inner =%';
  commit work;
  insert into #temp_cmg_attrib
    select distinct
      Row_Id,
      Customer_Id,
      Account_Id,
      Unique_Id,
      Category,
      Sub_Category,
      Source,
      Audit_Date,
      Attribute_1,
      Attribute_2,
      Attribute_3,
      Record_Creation_Date,
      Record_Modification_Date,
      Record_Valid_Flag,
      Gl_Sub_Head_Code,
      Rmks,
      Func_Code,
      Init_Sol_Id,
      Enterer_Id,
      Auth_Id,
      Table_Name,
      Auth_Sol_Id
      --into #temp_cmg_attrib 
      from #temp_2;
  commit work;
  delete from #temp_cmg_attrib where b_attribute_2 = b_attribute_3;
  commit work;
  ---------------------------------------------------------
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  insert into EDW.TEMP_BIU_NON_FIN_DETAILS_N_SUR_Intrdy
    select distinct
      null as Row_Id,
      b_Customer_Id,
      b_Account_Id,
      b_Unique_Id,
      b_Category,
      b_Sub_Category,
      b_Source,
      b_Audit_Date,
      b_Attribute_1,
      b_Attribute_2,
      b_Attribute_3,
      b_Record_Creation_Date,
      b_Record_Modification_Date,
      b_Record_Valid_Flag,
      b_Gl_Sub_Head_Code,
      b_Rmks,
      b_Func_Code,
      b_Init_Sol_Id,
      b_Enterer_Id,
      b_Auth_Id,
      b_Table_Name,
      b_Auth_Sol_Id
      from #temp_cmg_attrib;
  commit work;
  /*
delete EDW.TEMP_BIU_NON_FIN_DETAILS_N_SUR_Intrdy
from EDW.TEMP_BIU_NON_FIN_DETAILS_N_SUR_Intrdy a,
(select customer_id,account_id,category,sub_category,source,attribute_1,isnull(attribute_2,'x') att_2,attribute_3,enterer_id,max(rowid(TEMP_BIU_NON_FIN_DETAILS_N_SUR_Intrdy)) 
max_rowid
from EDW.TEMP_BIU_NON_FIN_DETAILS_N_SUR_Intrdy
group by customer_id,account_id,category,sub_category,source,attribute_1,isnull(attribute_2,'x'),attribute_3,enterer_id)b
where 
a.customer_id=b.customer_id and 
a.account_id=b.account_id and 
a.category=b.category and 
a.sub_category=b.sub_category and 
a.source=b.source and 
a.attribute_1=b.attribute_1 and 
isnull(a.attribute_2,'x')=att_2 and 
a.attribute_3=b.attribute_3 and 
a.enterer_id=b.enterer_id 
and rowid(a)!=max_rowid;
commit;
*/
  update EDW.TEMP_BIU_NON_FIN_DETAILS_N_SUR_Intrdy
    set row_id = number();
  commit work
end
